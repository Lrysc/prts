# 多数据源导入功能说明

## 功能概述

已成功实现多数据源导入功能，支持用户导入多个数据文件，并在界面上以分组形式展示，每个数据源都有清晰的标题区分。

## 主要功能特性

### 🔄 多数据源支持
- 支持连续导入多个数据文件
- 每个数据源自动命名为"数据1"、"数据2"等
- 保留原始文件名和导入时间信息

### 📊 分组显示
- 每个数据源有独立的标题区域
- 显示数据源名称、文件名和导入时间
- 每个数据源内的卡池按层次结构展示

### 🎨 界面优化
- 现代化的卡片式设计
- 深色主题配色方案
- 清晰的视觉层次结构
- 响应式布局适配

### 📋 数据统计
- 实时显示总数据源数量
- 显示总卡池数量和记录数量
- 每个数据源显示其包含的卡池数量

## 技术实现

### 数据结构重构
```typescript
// 新的数据结构支持多数据源
interface ImportedDataSource {
  sourceName: string;        // 数据源名称 (如"数据1")
  fileName: string;          // 原始文件名
  importTime: number;         // 导入时间戳
  uid?: string;              // 用户ID (如果有)
  categories: Array<{        // 卡池列表
    categoryName: string;
    categoryId?: string;
    records: GachaRecord[];
  }>;
}
```

### 核心功能更新

1. **导入逻辑增强**
   - 支持追加式导入，不覆盖已有数据
   - 自动生成数据源名称
   - 保留完整的文件信息

2. **展开/折叠机制**
   - 支持按数据源和卡池级别的展开/折叠
   - 使用复合键管理展开状态
   - 一键展开/折叠所有卡池

3. **数据导出**
   - 支持合并导出所有数据源的数据
   - 保持原有的去重和排序逻辑

### UI组件更新

#### 数据源标题区域
- 显示数据源名称、文件名、导入时间
- 统计该数据源包含的卡池数量
- 深色背景突出显示

#### 卡池列表
- 缩进显示，层次分明
- 支持独立展开/折叠
- 保持原有的表格展示功能

## 使用方式

### 导入多个数据文件
1. 点击"导入寻访记录"按钮
2. 选择第一个数据文件并导入
3. 再次点击"导入寻访记录"按钮
4. 选择第二个数据文件并导入
5. 重复此过程可导入更多数据文件

### 查看和管理数据
- 每个数据源都有独立的标题区域
- 可单独展开/折叠每个卡池
- 使用"全部展开"/"全部折叠"快速操作
- "清除数据"会清空所有已导入的数据源

### 导出合并数据
- 点击"导出合并数据"按钮
- 系统会将所有数据源的卡池按类型合并
- 自动去重并按时间排序

## 样式设计

### 配色方案
- 主背景: `#2d2d2d`
- 数据源背景: `#252525`
- 标题区域: `#1a1a1a`
- 卡池区域: `#2d2d2d`
- 悬停效果: `#333333`

### 布局特点
- 8px 圆角设计
- 1px 边框分隔
- 适当的内边距和间距
- 响应式字体大小

## 兼容性

- ✅ 支持通用格式文件（带RSA签名）
- ✅ 支持新格式导出文件
- ✅ 支持旧格式数组文件
- ✅ 保持原有的RSA签名验证功能

## 注意事项

1. **性能考虑**: 大量数据源可能影响界面性能，建议合理控制导入数量
2. **内存管理**: 导入的数据会占用内存，使用"清除数据"可释放内存
3. **文件格式**: 确保导入的文件格式正确，系统会自动识别并处理不同格式

## 后续优化建议

1. 添加数据源重命名功能
2. 支持拖拽调整数据源顺序
3. 添加数据源筛选和搜索功能
4. 支持单独导出某个数据源的数据