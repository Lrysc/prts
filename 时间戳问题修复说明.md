# 时间戳问题修复说明

## 发现的问题

1. **时间戳格式不一致** - 不同来源的数据使用不同的时间戳格式
2. **类型处理混乱** - 字符串和数字类型混合处理
3. **调试信息不足** - 无法准确诊断时间戳转换问题

## 修复内容

### 🔧 改进的时间戳格式化函数

```typescript
const formatTime = (timestamp: string | number) => {
  // 统一处理字符串和数字类型
  let ts: number;
  if (typeof timestamp === 'string') {
    ts = parseFloat(timestamp);
  } else {
    ts = timestamp;
  }

  // 智能判断秒级 vs 毫秒级
  if (ts > 1000000000000) {
    // 毫秒级时间戳
    date = new Date(ts);
  } else if (ts > 1000000000) {
    // 秒级时间戳，转换为毫秒
    date = new Date(ts * 1000);
  }
}
```

### 📊 支持的时间戳格式

| 格式 | 示例 | 说明 | 处理方式 |
|------|------|------|----------|
| 10位数字 | `"1755219678"` | 秒级时间戳 | 乘以1000转换为毫秒 |
| 13位数字 | `"1755219678000"` | 毫秒级时间戳 | 直接使用 |
| 数字类型 | `1755219678` | 秒级时间戳 | 乘以1000转换为毫秒 |
| 数字类型 | `1755219678000` | 毫秒级时间戳 | 直接使用 |

### 🔍 增强的调试信息

现在格式化时间戳时会输出详细的调试日志：
- 原始时间戳值和类型
- 识别的时间戳格式（秒级/毫秒级）
- 解析后的日期时间
- 格式化后的本地时间
- 异常情况警告

### ⚠️ 日期有效性检查

- **未来时间检测** - 如果时间戳表示未来时间会发出警告
- **过早时间检测** - 如果时间戳早于2020年会发出警告
- **无效日期检测** - 如果解析结果无效会返回错误信息

## 常见时间戳问题

### 1. 小黑盒格式文件
```json
{
  "data": {
    "1755219678": {  // 10位秒级时间戳
      "c": [["空构", 4, 0]],
      "p": "不归火"
    }
  }
}
```
**处理方式**: 识别为秒级时间戳，转换为毫秒后格式化

### 2. API返回数据
```typescript
{
  gachaTs: "1755219678000"  // 13位毫秒级时间戳
}
```
**处理方式**: 直接使用毫秒级时间戳格式化

### 3. 旧格式文件
```json
{
  "gachaTs": "1755219678"  // 10位秒级时间戳
}
```
**处理方式**: 识别为秒级时间戳，转换为毫秒后格式化

## 测试建议

1. **导入测试文件** - 使用项目中的测试文件验证时间戳显示
2. **查看控制台** - 观察时间戳解析的调试信息
3. **验证显示** - 确认时间显示为合理的日期时间
4. **检查格式** - 确认时间格式为本地化的中文格式

## 预期效果

修复后，所有时间戳都应该：
- ✅ 正确识别格式（秒级/毫秒级）
- ✅ 准确转换为日期时间
- ✅ 显示为本地化的中文格式
- ✅ 提供详细的调试信息
- ✅ 检测并报告异常情况

## 如果仍有问题

如果时间戳显示仍然不正确：
1. 检查控制台的调试信息
2. 确认时间戳的原始值和格式
3. 验证是否为有效的时间戳范围
4. 检查是否有特殊的格式需要额外处理